rm -rf /etc/ceph
rm -rf /var/lib/ceph
rm -rf /opt/ceph/rbd
rm -rf /var/log/ceph
mkdir -p /etc/ceph /var/lib/ceph /var/lib/ceph/osd /opt/ceph/rbd /var/log/ceph
chown -R 167:167 /etc/ceph
chown -R 167:167 /var/lib/ceph
chown -R root:root /etc/ceph/ceph.conf

mkfs.xfs /dev/sdb -f
mount /dev/sdb /opt/ceph/rbd

ceph-deploy purge dbs-server10
ceph-deploy purgedata dbs-server10
ceph-deploy forgetkeys


docker run -d \
--name mon \
--restart=always \
--mount type=bind,src=//etc/ceph,dst=/etc/ceph \
--mount type=bind,src=//var/lib/ceph,dst=/var/lib/ceph \
--env MON_IP=172.21.32.110 \
--env DEBUG=stayalive \
--env CEPH_PUBLIC_NETWORK=172.21.32.0/24 \
--network=host \
--label com.docker.stack.namespace=dbs \
ceph/daemon:latest-devel mon

docker run -d \
--name mgr \
--restart=always \
--mount type=bind,src=//etc/ceph,dst=/etc/ceph \
--mount type=bind,src=//var/lib/ceph,dst=/var/lib/ceph \
--network=host \
--label com.docker.stack.namespace=dbs \
ceph/daemon:latest-devel mgr

docker run -d \
--name osd \
--privileged=true \
--restart=always \
--mount type=bind,src=//etc/ceph,dst=/etc/ceph \
--mount type=bind,src=//var/lib/ceph,dst=/var/lib/ceph \
--mount type=bind,src=//dev,dst=/dev \
--mount type=bind,src=//var/lib/ceph/osd,dst=/opt/ceph/rbd \
--network=host \
--label com.docker.stack.namespace=dbs \
ceph/daemon:latest-devel osd

docker exec mon ceph auth get client.bootstrap-osd -o /var/lib/ceph/bootstrap-osd/ceph.keyring 
docker exec mon ceph auth get client.bootstrap-mds -o /var/lib/ceph/bootstrap-mds/ceph.keyring 
docker exec mon ceph auth get client.bootstrap-rgw -o /var/lib/ceph/bootstrap-rgw/ceph.keyring 

docker exec mgr ceph mgr module enable rbd_support
docker exec mgr ceph mgr module enable dashboard
docker exec mgr ceph dashboard create-self-signed-cert
docker exec mgr ceph dashboard set-login-credentials ceph ceph
docker exec mgr ceph config set mgr mgr/dashboard/server_addr 172.21.32.110
docker exec mgr ceph config set mgr mgr/dashboard/server_port 7000
docker exec mgr ceph config set mgr mgr/dashboard/ssl false
docker restart mgr
docker exec mgr ceph mgr services


rexray uninstall
rm -rf $(find / -name rexray)
rm -rf $(find / -name libstorage)
curl -sSL https://rexray.io/install | sh -s -- stable 0.9.2

docker plugin disable rexray/rbd
docker plugin rm rexray/rbd

docker plugin install rexray/rbd RBD_DEFAULTPOOL=rbd LINUX_VOLUME_FILEMODE=0777 LINUX_VOLUME_ROOTPATH=/opt/ceph/rbd RBD_CEPHARGS="--cluster 7904351f-7413-4e00-800e-a73ee7c969eb" RBD_TESTMODULE=true 
docker plugin ls
docker plugin inspect rexray/rbd 

apt-get install -y ceph-common
apt-get install -y rbd-nbd


rm -rf /etc/rexray/config.yml
mv /home/zhangkun/config.yml /etc/rexray
chown -R root:root /etc/rexray/config.yml

systemctl enable rexray;
systemctl start rexray;
systemctl status rexray;

rexray volume ls
docker volume create --driver=rexray/rbd:latest --name=test



cd /var/lib/dpkg
rm -rf info
mkdir info 
apt-get upgrade
cd /opt/ceph


